# Preview版本 不代表最终品质 请静等更新
# 自制省钱高性价比maimaiDX触屏控制器新版教程
## 与旧版的比较
1. 采用最新做法编写新教程，采用最新的研究成果，与最前沿的思路
2. 新版走线方式，干扰更少，性能更高
3. 简化制作步骤，制作更美观
4. 将教学群内教学内容和文章结合，配合大家曾经提出的问题加以细致解释，避免困惑
5. 也许以后标题会改成"自制省钱高性价比maimaiDX全套控制器新版教程"
6. 添加过程图片和更多的原理解释


~~旧版文档相当落后没有更新，内部做法很多已经弃用，非常丢人，非常乱~~   


**本教程着重关注触屏这一部分，对于按键，固定结构等并不关注，也不提供教程，后续可能会加，但是不要期望现在的以下内容会有结构，按键，屏幕之类的内容，更不会提供任何关于游戏软件的任何支持**  
**目前着重更新主要内容部分，对于协力者感谢，版权声明和一些公告，一些注意事项，一些会大概率导致失败的制作细节反例，请参阅旧版教程！！！（在上面代码那块里面）**
**本文章硬件部分制作完全原创，若有类似，可能是平行互不干扰的项目**
**程序部分是基于已有开源项目经过调试参数数周修改得到，并非直接搬用，可以自行查阅代码，很多部分不一样**
## 第一部分 总览

本作品旨在弄个便宜好用的方案，让大多数人都可以轻松把这个东西做出来，同时不要效果差到没法玩。
新教程的思路是引导思考，提出不同做法来比较，让您自行选择自己喜欢的做法去做  

**[成功作品展示]**

Under Wrinting
Todo:Add pictures

**以下说法是个人定义，配合解释，可能对很多人不适用，自行判断哦！** 
**以下说法仅适用于触屏部分在完全按照要求**  
难度：**一般**    
```
**不对所有人制作难度做保证，以下内容为对部分人来说制作难度的一种参考**
**每个人的实现都不一样，每个人买到的材料也不一样，每个人成功与否，效果好不好肯定也不一样**
其实触屏这块制作已经被简化了很多，改进了很多，
旧版教程很多东西都已经弃用，此新版做法相当好理解，
我认为对于16岁以上有耐心的大部分人都可以完成，
其中最要求严格的就是裁切和贴装ito膜，要求严格的精确，
其他部分，就【触屏这块触摸面板部分】而言，
已经没有任何难度，不需要特别多的思考。
几乎不需要有代码能力，代码开箱即用，
只需要调整少量阈值即可。
按照教程严格规范制作，目前未见有人失败
有失败或者教程很差的，可以看看他们的不听话，触摸区块裁的歪歪扭扭，
贴的一边近一边远，根本不按要求来，不按照教程要求来，这失败本教程不背锅
```  

成本：**按照已有工具情况下计算较低**
```
就这样说吧，43寸触摸面板（不算按键，固定什么的，只算这块玻璃和旁边木板）
有工具的话500元以内就可以搞定了，省着些，细心些，避免浪费，可能三四百就结束了
```

耗时：**可能较长**
```
快递很慢是主要原因。
其次虽然操作都简单，但是裁切，贴装，引线，都是大量重复简单事情，
所以虽然简单，都是需要耐心，耗费时间可能较多一些
```
效果：**大概是目前来说最好的自制法了吧，已测试一般运行，打歌没有啥问题，
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要是自制的玩家好像技术都是中等级别，主要是没大爹测试，测不到
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;性能极限（现在受限本方案测试的玩家个人水平，在官方机台也无法打
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;出更好成绩，更无法测试自制台上限，故目前本方案上限未知，并非方
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;案自身有问题）**
```
**不对制作效果做保证，以下内容为对制作效果的一种参考**
**每个人的实现都不一样，每个人买到的材料也不一样，每个人成功与否，效果好不好肯定也不一样**
感应，手套触摸各方面都没有问题。
两位佬说，触摸灵敏度优于他们那边的机台
一位佬说，触摸灵敏度没有达到官机一根手指直立也能稳定感应的那么厉害
延迟，刷新率按照理论计算理论上优于机台上那块触摸面板
但是对于虚空触发（手不放上去，也会有自动点击的现象），
根据每个人做的不一样，显示器发出的干扰不一样，还是有一些的。
好像43寸这种情况，大约几分钟内分钟有个一下两下的？
虽然可能会少量影响心情，但是佬们表示好像并不影响打歌？
32寸以及32寸以下，这种情况好像没听说过有
并且虚空触发好像在经常触摸屏幕的情况下，会变少很多，或者几乎不发生
所以按照这样，打歌过程中应该是不会有影响的
```

## 第二部分 注意事项和声明
Under Wrinting

**本教程仅仅为了以下目的：**
1. 不为追求完美的外观
2. 不为追求完美无缺的使用体验
3. 不为追求每个人都必须成功
4. 不追求绝对的高性能，做到基本13+能够正常打，再高性能不做保证（目前有用本方案14+ S评级的验证，受限于游玩者个人水平，目前无法确认最高性能在哪里（他在官机上也无法完成更高成绩））
5. 在成本低，难度低的情况下做出一个**能用**的基本触摸面板
6. 故高价定制蚀刻面板等操作，不在本项目讨论范围内
7. 判定精准>美观性 我们不会为了美观而做某些方案触摸到漂亮的分区走线就会导致区块触发的蹭的方案，我们认为还原判定比美观要好

### 不保证每个人都能成功，失败或者效果差与本教程无关
本教程并非最好做法，只是万千做法的其中一个而已，如果你有更好的思路，欢迎分享出来帮助大家！（而非觉得自己很厉害就来喷这个方案，你很厉害可以发出来造福大家啊，而不是完全闭源，诶，我比你厉害，我比你好，但是就是不发，自己想想真正需要方案的玩家会赞同你吗，大家支持的是能帮助到大家的人，把方案开源，分享思路，推动进步，人人支持！）  
我们的目的是为玩不到的玩家能玩到，并非自己做一个就不用去游戏厅花钱，若有游戏厅近，请支持官方机台。

## 第三部分 对于现在不同触屏大方向的对比
目前主流做法有以下几种：

1. 红外触屏框
2. 普通多点触控电容屏
3. 分区触控电容屏（与官方相同的实现方法）

以下进行对比

#### 1. 红外触屏
采用横竖摆放大量红外对射LED和接收管的方式，依据光在均匀介质中沿直线传播的特点，手穿过光线，主控检测到阻挡后就会判断已经触摸上。
缺点：因为需要巨量的轮询xy轴相当多的接收管状态，此类屏幕一般延迟较高；因为是挡光形式的，设想两只手斜着平行放入触摸区域，因为挡光的问题，会被错误的识别，因而造成无法正常触发的问题；由于反馈给电脑，一整个大手上去会被识别成手中心一个触摸点，故只有中心位置一个区块会触发，造成严重的一个吃，特别是一些邪道不能用，不能糊，要避免，必须要用分离的手指打歌，并指都可能出问题。走普通hid触摸协议，windows下会显示触摸点，长按会出框右键等。
优点：凡不能透光的物体都能触发，根本不担心手套触摸；此类触摸框相当便宜，43寸也就四百以下？不仅可以用于mai，也可以用于其他地方。
改进：红外框具有读取触摸点长宽的能力，如果能把这点用好，就能基本估算手完全遮挡哪些区块，避免吃的现象发生（类似希沃、东方中原白板板擦识别功能）此思路目前未见有人做
由于目前延迟，吃，不能手掌多方面问题，我认为这不是三个方法中最好的方法。
#### 2. 普通多点触控电容屏
（跟现在普通手机或者平板触摸屏是一个东西）  
~~没有详细了解过具体原理，以下是猜的~~  
大概是横竖许多条触摸条，同样通过xy双方向读取，与红外不同的是，此操作没有跟红外一样一挡光就全没了这种，所以各触摸点互不影响。同样，此方法触摸条不多，轮询较快，延迟低。
缺点：一个大触摸点类似手掌上去，最离谱的情况下也是会被认为是一个触摸点，跟红外一样，手掌覆盖的所有区块不能全部触发，因此跟红外一样会有一个严重的吃，特别是一些邪道不能用，不能糊，要避免，必须要用分离的手指打歌，并指都可能出问题。另外市售成品电容触摸外屏可能对手套触摸的支持存疑。价格可能较高。走普通hid触摸协议，windows下会显示触摸点，长按会出框右键等。
优点：延迟较低，不仅可以用于mai，也可以用于其他地方。不会受类似红外遮挡就挂的影响。
改进：部分电容屏幕也具有读取触摸点形状和大小的能力，虽然一个异形物体只会被识别成一个触摸点，但是实际上数据里面是有具体形状大小的，如果能把这点用好，就能大概计算手完全遮挡哪些区块，类似android9彩蛋画图，不过那个用的是电容屏压力感应功能，大差不差，如果你有LG G8（？不记得了），开发者模式打开触摸点显示那一类的，用手指换着接触面形状点击屏幕，可以看到屏幕对于触摸点形状大小的描绘，如果你有surface，打开surface诊断工具，到触摸点个数那块，也能体验到电容触屏对于形状大小识别方面的效果。
由于目前吃，不能手掌，手套可能不行多方面问题，我认为这不是三个方法中最好的方法。
#### 2. 区块触摸电容触屏方案
**目前认为是官方机台采用的方案**  
缺点：没有现成售卖的低价成品，要低价实现，必须自己做，根据方案不同，可能存在不同的缺点，因此此处无法描述，但是吃之类的，不能邪道之类的缺点全无，大多都能做到官机体验，完全一样的判定等。只有区块可以触摸，不能用作普通触屏使用。一般需要距离显示屏一小段距离才能正常工作
优点：走原生通道，不经过windows触摸，没有显示触摸点，右键等奇葩情况。一般延迟极低。手接触到的区块全部可以同时触发。可以使用跟官方机台一样的手法，操作，不吃，可糊。价格低。官方类似实现方案。可用、灵敏的手套触摸
由于跟官方机台手感，手法可用一致，延迟低，手套触摸，我认为这不是三个方法中最好的方法。
**以下制作就是我自己思路自行设计的区块电容触摸方案，只有这一个，红外的，普通电容的，这里不教，也没什么好教的，那些到手即用**

## 第四部分 区块电容触摸屏设计总览
**本部分目的：使读者明白总体结构，明白个大概，更好地理解制作难度，选择做还是不做；使读者知道整个基本框架是什么样子，大概都有什么部分；使读者知道大概需要什么材料，为下一部分的选材做铺垫**

![区块电容触摸屏设计总览1](pics2/touchall.jpg)
**从上图可以看出，整体触摸面板结构还是非常简单的！**
（~~删除线~~内容是新教程Preview版本编写时候写了又感觉不合适删减了的内容，留做参考但是主要内容一定会有新写法替代删除的内容而且写得更好，所以这部分内容一般选择直接跳过为好）
~~**同时可以看出，需要的材料基本有以下内容：**~~
~~1. ITO导电膜（**单面带胶**（重要！！！我自己当时贪便宜没有带胶，回来自己上胶非常困难和丑，很难把厚度掌控好，很累很累，做出来非常难看！！））~~
~~2. 漆包线~~
~~3. mpr121模块 3-4 个（总共34个区块8A8B2C8D8E，每个mpr121从0-11共12个触摸点支持，故最少3个mpr足够，为了走线布线好走，目前大多选择4个）~~
~~4. 固定漆包线到ito导电面的材料~~
~~5. 透明板一块，建议正八边形，也可以自己选择，但是圆形很少有人用（难以固定）~~
~~6. 普通连接线，连接mpr模块和单片机开发板（不在图片内）~~
~~7. 单片机开发板~~

~~**显然还需要很多工具对吧  ~~
~~焊接系列**~~
~~1. 调温电烙铁~~
~~2. 焊锡丝~~
~~3. 助焊剂（重要！！）~~
~~4.（可选）维护/辅助用的工具，如高温海绵，吸锡带之类的焊接辅助用具~~
   
~~**其他工具**~~ 
~~1. 去除漆包线漆皮用的工具~~
~~2. 螺丝刀等固定用的工具~~

~~特殊工具~~  
~~部分先进做法如[自行蚀刻法]将会使用，暂时没有编写完对应做法，于是这里暂时不编写~~

**从此部分开始,因为现在可选做法很多，就一个区块引出就有好几种做法，每种做法所用材料不同，步骤不同，故以下内容每一章节会有多个分支，请注意选择自己需要的哪一个分支**

我们可以看出整体分为以下几个部分
1. 导电区块
2. 区块引出
3. 区块引出线固定
4. 触摸检测模块
5. 主控单片机（图中未拍到）
6. 基层透明板
7. 固定材料和大底板

以上所示内容现在有多种实现方式，故**现在展示主要划分，下文对每种做法详细说明，并教你如何选材**。因为实现方式不同，需要准备的材料也不同，故这里并不会说明具体材料，只有个大概。

## 第五部分 实现方式和材料选择选型指南

**针对上文提出的七个部分，分别讨论具体实现方式和选材方向**
### 1. 导电区块

导电区块说的是对于分区电容的一共34个区块，怎么实现让这几个区块导电且透明和怎么实现区块形状大小的限定

todo

### 2. 区块引出

区块引出说的是对于已经划分出来的能导电的透明的区块，如何把区块引出到触摸面板边缘并连接触摸检测模块

todo

### 3. 区块引出线固定

区块引出线固定说的是对于上述区块引出方式，若使用线等材料，怎么与导电区块间接触固定的实现方法

todo

### 4. 触摸检测模块

触摸检测模块是对于已经引出出来的区块，用什么模块/IC来对是否触摸做出检测并作为一定协议的信号与主控单片机通信

todo

### 5. 主控单片机（图中未拍到）

主控单片机说的是对于触摸检测好的信号，转换成可以连接电脑的USB/串口信号等用的芯片/开发板

todo

### 6. 基层透明板

基层玻璃说的是将区块等内容固定加固的面板和手接触的面板，可能这样说徒增抽象，实际上就是那块手摸到的透明（玻璃一类的）板，也是要把区块贴/做上去的透明（玻璃一类的）板

todo

### 7. 固定材料和大底板

固定材料和大底板说的是最外面把基层透明板固定，也接驳外面整体固定架子的一块板子，这样说也是徒增抽象，可以看图就是指最外面那个黑色木板和金属固定件类似物体

todo

## 第六部分 触摸屏制作详细步骤
## 第七部分 触摸屏制作特别注意事项
## 第八部分 开发环境搭建和程序烧录
## 第九部分 程序灵敏度和参数调试
## 第十部分 完成
